<!DOCTYPE html>
<html>
<head>
<title>ðŸŽ¤ Clap-Controlled Mouse</title>
<style>
body { font-family: Arial; text-align: center; background: #222; color: white; }
button { padding: 10px 20px; margin: 5px; font-size: 16px; }
input[type=range] { width: 200px; }
#meter-container { width: 300px; height: 20px; background: #555; margin: 10px auto; }
#meter-fill { height: 100%; background: lime; width: 0%; }
</style>
</head>
<body>
<h1>ðŸŽ¤ Clap-Controlled Mouse</h1>
<p>Status: <span id="status">Stopped â›”</span></p>
<p>Last Action: <span id="lastAction">None</span></p>

<div id="meter-container"><div id="meter-fill"></div></div>
<p>Live Volume: <span id="volumeValue">0.00</span></p>

<label>Sensitivity: <span id="sensitivityValue">0.3</span></label><br>
<input type="range" min="0.1" max="1.0" step="0.05" value="0.3" id="sensitivitySlider">

<br><br>
<button onclick="startListening()">Start Listening</button>
<button onclick="stopListening()">Stop Listening</button>

<script>
const es = new EventSource('/stream');

es.addEventListener('status', e => {
    const data = JSON.parse(e.data);
    document.getElementById('status').innerText = data.status;
});
es.addEventListener('action', e => {
    const data = JSON.parse(e.data);
    document.getElementById('lastAction').innerText = data.action;
});
es.addEventListener('threshold', e => {
    const data = JSON.parse(e.data);
    document.getElementById('sensitivityValue').innerText = data.threshold;
    document.getElementById('sensitivitySlider').value = data.threshold;
});
es.addEventListener('volume', e => {
    const data = JSON.parse(e.data);
    const v = data.volume;
    document.getElementById('volumeValue').innerText = v.toFixed(3);
    const px = Math.min(v * 2, 300);
    document.getElementById('meter-fill').style.width = px + "px";
});

function startListening() {
    fetch('/start', {method: 'POST'});
}
function stopListening() {
    fetch('/stop', {method: 'POST'});
}

document.getElementById('sensitivitySlider').addEventListener('input', e => {
    const val = parseFloat(e.target.value);
    document.getElementById('sensitivityValue').innerText = val;
    fetch('/set_threshold', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({value: val})
    });
});
</script>
</body>
</html>
